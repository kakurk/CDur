---
title: "Memory Cue Duration and Directed Forgetting"
author: "Kyle Kurkela and Nancy Dennis"
date: '`r Sys.Date()`'
output: 
  html_notebook:
    code_folding: hide  
    toc: true
    toc_float: true
params:
  datapath: ./data/
---

# Initalize

## Loading Libraries

```{r libraries, message=FALSE, warning=FALSE}
library('tidyverse')
library('knitr')
```

## Load Data

```{r load}
# Initalize variables
datapath           <- params$datapath
ya_raw_data_file   <- paste0(datapath, "ya_raw_data.csv")
oa_raw_data_file   <- paste0(datapath, "oa_raw_data.csv")
demo_raw_data_file <- paste0(datapath, "demographics.csv")

# Load data into dataframes
df.young        <- read.csv(ya_raw_data_file, quote = "\'")
df.old          <- read.csv(oa_raw_data_file, quote = "\'")
df.demographics <- read.csv(demo_raw_data_file, quote = "\'")
```

## Data Cleaning

### Demographics

1. Drop Empty Variables  
2. Create EDUCATION_yrs variable, which calculates the EDUCATION variable in terms of years of schooling  
3. Compute a composite Cognitive Assessment variable by calculating the mean (rounded to 2 decimal points) of the each subject's Symbol Search, Digit-Symbol, Arithmetic, Letter-Number Sequencing, and Vocabulary scores 

```{r clean_demographics_data}
# dropping blank variables; creating EDUCTION_yrs
df.demographics %>%
  select(-X, -X.1) %>%
  mutate(EDUCATION_yrs = ifelse(EDUCATION == '8th grade', 8,
                         ifelse(EDUCATION == '9th grade', 9, 
                         ifelse(EDUCATION == '10th grade', 10,
                         ifelse(EDUCATION == '11th grade', 11,
                         ifelse(EDUCATION == '12th grade', 12,
                         ifelse(EDUCATION == '1 yr college' | EDUCATION == '1 Year college' | EDUCATION == '1 year college', 13,
                         ifelse(EDUCATION == '2 yrs college' | EDUCATION == '2 Years college' | EDUCATION == '2 years college', 14,
                         ifelse(EDUCATION == '3 yrs college' | EDUCATION == '3 Years college' | EDUCATION == '3 years college', 15,
                         ifelse(EDUCATION == '4 yrs college' | EDUCATION == '4 Years college' | EDUCATION == '4 years college', 16,
                         ifelse(EDUCATION == 'Post-grad work', 17,
                         ifelse(EDUCATION == 'Masters', 18,
                         ifelse(EDUCATION == 'Doctoral', 20, NA)))))))))))),
         Sex = ifelse(Sex == 'F', 'Female', 
               ifelse(Sex == 'M', 'Male', NA))) -> df.demographics 

# Force Age and Sex variables into the all capitalization variable name convention
colnames(df.demographics)[10:11] <- c("AGE", "SEX")

# Calculating Cognitive Assessment Composite Score
df.demographics %>%
  rowwise() %>%
  mutate(BASELINE_COGITIVE_ABILITY = mean(c(SYMBOLSEARCH, DIGITSYMBOL, DIGITSPAN, 
                                            ARITHMETIC, LNSEQUENCING, VOCAB), na.rm = TRUE),
         BASELINE_COGITIVE_ABILITY = round(BASELINE_COGITIVE_ABILITY, digits = 2)) -> df.demographics
```

### Raw Experimental Data

1. Concatenate the young and old data, creating a new factor AgeGroup  
2. Drop the extra jitter varaiable  
3. Make the numeric coding schemes factors with informative levels  

```{r concatenate_and_clean, warning=FALSE}
# concatenate
df.all <- bind_rows(list(df.young, df.old), .id = "AgeGroup")

# clean
df.all %>%
  select(-jit.1) %>%
  mutate(
    enctype  = ifelse(enctype == 1, '1 Second',
               ifelse(enctype == 3, '3 Seconds', 
               ifelse(enctype == 5, '5 Seconds', 'Lure'))),
    enctype  = factor(enctype),
    score    = ifelse(score == 1, 'Remember',
               ifelse(score == 2, 'Know',
               ifelse(score == 3, 'New', 'No Response'))),
    score    = factor(score),
    Response = ifelse(Response == 2, 'B Key',
               ifelse(Response == 22, 'V Key',
               ifelse(Response == 14, 'N Key', 'No Response'))),
    Response = factor(Response),
    type     = ifelse(type == 0, 'To Be Forgotten', 
               ifelse(type == 1, 'To Be Remembered', 'Lure')),
    type     = factor(type),
    AgeGroup = ifelse(AgeGroup == 1, 'Young', 
               ifelse(AgeGroup == 2, 'Old', NA)),
    AgeGroup = factor(AgeGroup)
  ) -> df.all
```

# Figure 1: Demographics Summary Table

```{r demographics_summary, warning=FALSE}

df.demographics %>%
  mutate(
    AgeGroup = factor(ifelse(AGE > 30, 'Old Adults', 'Younger Adults'))
  ) %>%
  select(-SUBJECT) %>%
  group_by(AgeGroup) %>%
  summarize_if(is.numeric, mean, na.rm = TRUE) %>%
  mutate_if(is.numeric, round, digits = 2) %>%
  gather(key=Measure, value=Mean, -AgeGroup) ->  temp

  temp %>%
   filter(AgeGroup == "Old Adults") -> OAs
  temp %>%
    filter(AgeGroup == "Younger Adults") -> YAs
  
table1.demographics  <- left_join(select(OAs, -AgeGroup), select(YAs, -AgeGroup), by = c("Measure"), suffix = c("_OA", "_YA"), "-AgeGroup")

names(table1.demographics) <- c("Measure", "Older Adults", "Younger Adults")

table1.demographics[9,1] <- "EDUCATION"
table1.demographics[10,1] <- "COMPOSITE"

table1.demographics

```

```{r replication_ttests}

df.all %>%
  filter(enctype != "Lure") %>%
  mutate(enctype = factor(enctype)) %>%
  group_by(AgeGroup, enctype, type, subject) %>%
  summarize(MissRate = mean(score == "New")) %>% ungroup() -> df.missrates

df.missrates %>% filter(type == "To Be Forgotten") %>% select(-type) -> TBF.Forgotten
df.missrates %>% filter(type == "To Be Remembered") %>% select(-type) -> TBR.Forgotten

df.DFeffects <- left_join(TBF.Forgotten, TBR.Forgotten, by = c('AgeGroup','enctype', 'subject'), suffix = c("TBF", "TBR"))

df.DFeffects %>%
  transmute(
    AgeGroup = AgeGroup,
    enctype = enctype,
    subject = subject,
    DF.effect = MissRateTBF - MissRateTBR) -> df.DFeffects

# T-Tests by Condition
onesecond   <- t.test(df.DFeffects$DF.effect[df.DFeffects$enctype == '1 Second'], mu = 0)
threesecond <- t.test(df.DFeffects$DF.effect[df.DFeffects$enctype == '3 Seconds'], mu = 0)
fivesecond  <- t.test(df.DFeffects$DF.effect[df.DFeffects$enctype == '5 Seconds'], mu = 0)

# T-Tests by Age Group
young.test <- t.test(df.DFeffects$DF.effect[df.DFeffects$AgeGroup == 'Young'], mu = 0)
old.test   <- t.test(df.DFeffects$DF.effect[df.DFeffects$AgeGroup == 'Old'], mu = 0)


# T-Tests by Age Group by Condition
YA.onesecond   <- t.test(df.DFeffects$DF.effect[df.DFeffects$enctype == '1 Second' & df.DFeffects$AgeGroup == 'Young'], mu = 0)
YA.threesecond <- t.test(df.DFeffects$DF.effect[df.DFeffects$enctype == '3 Seconds' & df.DFeffects$AgeGroup == 'Young'], mu = 0)
YA.fivesecond  <- t.test(df.DFeffects$DF.effect[df.DFeffects$enctype == '5 Seconds' & df.DFeffects$AgeGroup == 'Young'], mu = 0)

OA.oneseconds  <- t.test(df.DFeffects$DF.effect[df.DFeffects$enctype == '1 Second' & df.DFeffects$AgeGroup == 'Old'], mu = 0)
OA.threesecond <- t.test(df.DFeffects$DF.effect[df.DFeffects$enctype == '3 Seconds' & df.DFeffects$AgeGroup == 'Old'], mu = 0)
OA.fivesecond <- t.test(df.DFeffects$DF.effect[df.DFeffects$enctype == '5 Seconds' & df.DFeffects$AgeGroup == 'Old'], mu = 0)

```


